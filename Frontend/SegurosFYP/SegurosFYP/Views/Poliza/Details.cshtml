@model SegurosFYP.Models.PolizaCompletaViewModel

@{
    ViewData["Title"] = "Pdf";
    ViewData["ModelName"] = "PolizaCompletaViewModel".Replace("ViewModel", "");
}

<div class="d-flex justify-content-end invoice-btn-section clearfix d-print-none mb-5" style="gap: 5px">
    <button id="imprimir" class="btn btn-primary">
        <i class="bi bi-download"></i> Descargar PDF
    </button>
    <a class="btn btn-primary" href="@Url.Action("Index", "Poliza")">
        <i class="bi bi-arrow-left"></i> Regresar
    </a>
</div>

<div id="invoice-content">
    <table class="table table-bordered mb-4">
        <tr class="bg-primary">
            <td colspan="8">ENCABEZADO</td>
        </tr>
        <tr>
            <th colspan="2">Cod. de contratante</th>
            <th colspan="2">Fecha de emision</th>
            <th colspan="2">No. de poliza</th>
            <th colspan="2">Cod. Agente de venta</th>
        </tr>
        <tr>
            <td colspan="2">@Html.DisplayFor(model => model.Cliente1.Perso_Id)</td>
            <td colspan="2">@DateTime.Now</td>
            <td colspan="2">@Html.DisplayFor(model => model.Poliza.Poliz_Id)</td>
            <td colspan="2">@Html.DisplayFor(model => model.Empleado.Emple_Id)</td>
        </tr>
    </table>

    <table class="table table-bordered mb-5">
        <tr class="bg-primary">
            <th colspan="8">A. DATOS GENERALES</th>
        </tr>
        <tr class="bg-primary">
            <th colspan="8">I. DATOS DEL AGENTE DE SEGURO</th>
        </tr>
        <tr>
            <th colspan="1">Agente</th>
            <td colspan="4">@Html.DisplayFor(model => model.Empleado.Perso_NombreCompleto)</td>
            <th colspan="1">Codigo del agente</th>
            <td colspan="2">@Html.DisplayFor(model => model.Empleado.Emple_Id)</td>
        </tr>
        <tr class="bg-primary">
            <th colspan="8">II. DATOS DEL CONTRATANTE</th>
        </tr>
        <tr>
            <td colspan="8"><b>DATOS PERSONA NATURAL</b></td>
        </tr>
        <tr>
            <th colspan="2">Primer Nombre</th>
            <th colspan="2">Segundo Nombre</th>
            <th colspan="2">Primer Apellido</th>
            <th colspan="2">Segundo Apellido</th>
        </tr>
        <tr>
            <td colspan="2">@Html.DisplayFor(model => model.Cliente1.Perso_PrimerNombre)</td>
            <td colspan="2">@Html.DisplayFor(model => model.Cliente1.Perso_SegundoNombre)</td>
            <td colspan="2">@Html.DisplayFor(model => model.Cliente1.Perso_PrimerApellido)</td>
            <td colspan="2">@Html.DisplayFor(model => model.Cliente1.Perso_SegundoApellido)</td>
        </tr>
        <tr>
            @if (Html.DisplayFor(model => model.Cliente1.Tiden_Id).ToString() == "1")
            {
                <th colspan="2">Tipo de Identificacion</th>
                <td colspan="2"><b>Identidad</b></td>
                <td colspan="2">Pasaporte</td>
                <td colspan="2">Carne de residencia</td>
            }
            else if (Html.DisplayFor(model => model.Cliente1.Tiden_Id).ToString() == "2")
            {
                <th colspan="2">Tipo de Identificacion</th>
                <td colspan="2">Identidad</td>
                <td colspan="2"><b>Pasaporte</b></td>
                <td colspan="2">Carne de residencia</td>
            }
            else
            {
                <th colspan="2">Tipo de Identificacion</th>
                <td colspan="2">Identidad</td>
                <td colspan="2">Pasaporte</td>
                <td colspan="2"><b>Carne de residencia</b></td>
            }
        </tr>
        <tr>
            <th colspan="2">No. Identificacion</th>
            <th colspan="2">RTN</th>
            <th colspan="2">Fecha de nacimiento</th>
            <th colspan="2">Lugar de nacimiento</th>
        </tr>
        <tr>
            <td colspan="2">@Html.DisplayFor(model => model.Cliente1.Ident_Id)</td>
            <td colspan="2">@Html.DisplayFor(model => model.Cliente1.Ident_NumeroIdentificacion)</td>
            <td colspan="2">@Html.DisplayFor(model => model.Cliente1.Ident_FechaNacimiento)</td>
            <td colspan="2">@Html.DisplayFor(model => model.Cliente1.Ident_LugarNacimiento)</td>
        </tr>
        <tr>
            @if (Html.DisplayFor(model => model.Cliente1.Estci_Id).ToString() == "1")
            {
                <th colspan="1">Estado Civil</th>
                <td colspan="3"><b>S</b>   C   D   V   UL</td>
            }
            else if (Html.DisplayFor(model => model.Cliente1.Estci_Id).ToString() == "2")
            {
                <th colspan="1">Estado Civil</th>
                <td colspan="3">S   <b>C</b>   D   V   UL</td>
            }
            else if (Html.DisplayFor(model => model.Cliente1.Estci_Id).ToString() == "3")
            {
                <th colspan="1">Estado Civil</th>
                <td colspan="3">S   C   <b>D</b>   V   UL</td>
            }
            else if (Html.DisplayFor(model => model.Cliente1.Estci_Id).ToString() == "3")
            {
                <th colspan="1">Estado Civil</th>
                <td colspan="3">S   C   D   <b>V</b>   UL</td>
            }
            else
            {
                <th colspan="1">Estado Civil</th>
                <td colspan="3">S   C   D   V   <b>UL</b></td>
            }

            @if (Html.DisplayFor(model => model.Cliente1.Perso_Sexo).ToString() == "M")
            {
                <td colspan="4">Género =>      <b>Masculino</b>   Femenino</td>
            }
            else
            {
                <td colspan="4">Género =>     Masculino   <b>Femenino</b></td>
            }
        </tr>
        <tr>
            <th colspan="4">Nacionalidad</th>
            <th colspan="2">Estatura</th>
            <th colspan="2">Peso</th>
        </tr>
        <tr>
            <td colspan="4">@Html.DisplayFor(model => model.Cliente1.Paise_Nacionalidad)</td>
            <td colspan="2"></td>
            <td colspan="2"></td>
        </tr>
        <tr>
            <th colspan="1">Telefono 1</th>
            <td colspan="3">@Html.DisplayFor(model => model.Cliente1.Perso_Telefono)</td>
            <th colspan="1">Telefono 2</th>
            <td colspan="3"></td>
        </tr>
        <tr>
            <th colspan="2">Correo electronico 1</th>
            <td colspan="6">@Html.DisplayFor(model => model.Cliente1.Perso_CorreoElectronico)</td>
        </tr>
        <tr>
            <th colspan="2">Correo electronico 2</th>
            <td colspan="6"></td>
        </tr>
        <tr>
            <th colspan="2">Nombre del conyuge(completo)</th>
            <td colspan="6">@Html.DisplayFor(model => model.Conyugue.Perso_NombreCompleto)</td>
        </tr>
        <tr>
            <th colspan="8"><b>Direccion de residencia del contratante / asegurado</b></th>
        </tr>
        <tr>
            <td colspan="8">@Html.DisplayFor(model => model.Cliente1.Perso_Direccion)</td>
        </tr>
        <tr>
            <th colspan="2">Pais</th>
            <th colspan="3">Departamento</th>
            <th colspan="3">Municipio</th>
        </tr>
        <tr>
            <td colspan="2">@Html.DisplayFor(model => model.Cliente1.Paise_Descripcion)</td>
            <td colspan="3">@Html.DisplayFor(model => model.Cliente1.Depar_Descripcion)</td>
            <td colspan="3">@Html.DisplayFor(model => model.Cliente1.Munic_Descripcion)</td>
        </tr>
        <tr>
            <th colspan="2">Direccion completa</th>
            <td colspan="6">@Html.DisplayFor(model => model.Cliente1.Perso_Direccion)</td>
        </tr>
        <tr class="bg-primary">
            <th colspan="8"><b>Beneficiaros contingentes</b></th>
        </tr>
        <tr>
            <th colspan="4">Nombre</th>
            <th colspan="2">Identidad</th>
            <th colspan="2">Parentesco</th>
        </tr>
        @if (Model.Dependientes != null)
        {

            @foreach (var item in Model.Dependientes)
            {
                <tr>
                    <td>@item.Perso_NombreCompleto</td>
                    <td>@item.Ident_NumeroIdentificacion</td>
                    <td>@item.Paren_Descripcion</td>
                </tr>
            }
        }
        <tr class="bg-primary">
            <th colspan="8">DETALLES DE PLAN</th>
        </tr>
        <tr>
            <th colspan="1">Tipo de Plan</th>
            <td colspan="3">@Html.DisplayFor(model => model.TipodePlan.Tipos_Descripcion)</td>
            <th colspan="1">Cobertura</th>
            <td colspan="3">@Html.DisplayFor(model => model.TipodePlan.Cober_Descripcion)</td>
        </tr>
    </table>
</div>

<div class="d-flex justify-content-end invoice-btn-section clearfix d-print-none" style="gap: 5px">
    <button id="imprimir" class="btn btn-primary">
        <i class="bi bi-download"></i> Descargar PDF
    </button>
    <a class="btn btn-primary" href="@Url.Action("Index", "Poliza")">
        <i class="bi bi-arrow-left"></i> Regresar
    </a>
</div>
<script src="~/lib/jquery/dist/jquery.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.3.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.3.2/html2canvas.min.js"></script>
<script>
    $('#imprimir').click(function generatePDF() {
        console.log('hola')
        html2canvas(document.getElementById("invoice-content")).then(canvas => {
            const imgData = canvas.toDataURL('image/png');
            const pdf = new jspdf.jsPDF({
                orientation: "portrait",
                unit: "px",
                format: [canvas.width, canvas.height]
            });
            pdf.addImage(imgData, 'PNG', 0, 0, canvas.width, canvas.height);
            pdf.save("download.pdf");
        });
    })
</script>